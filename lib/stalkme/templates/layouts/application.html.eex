<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Stalk Me!</title>
  <link rel="shortcut icon" href="/static/favicon.ico" />
  <link rel="stylesheet" href="/static/assets/application.css">
</head>
<body>
  <div class="navbar">
    <div class="navbar-inner">
      <a class="brand" href="/">Stalk Me!</a>
        <%= if @current_user do %>
        <ul class="nav pull-right">
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
              <%= @current_user.name %>
              <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
              <li><a href="/users/<%= @current_user.id %>">My Statuses</a></li>
              <li><a href="/logout">Logout</a></li>
            </ul>
          </li>
        </ul>
        <% else %>
        <ul class="nav">
          <li><a href="/sessions/new">Login</a></li>
          <li><a href="/users/new">Register</a></li>
        </ul>
        <% end %>
      </ul>
    </div>
  </div>

  <div class="container">
    <%= @inner %>
  </div>
  <script src="/static/components/underscore/underscore.js" ></script>
  <script src="/static/components/jquery/jquery.js" ></script>
  <script src="/static/components/jquery-timeago/jquery.timeago.js" ></script>
  <script src="/static/components/jquery-form/jquery.form.js" ></script>
  <script src="/static/js/phoenix.js" ></script>
  <script src="/static/assets/application.js" ></script>
  <script type="text/javascript">
    (function () {
      var $statuses = jQuery('#statuses');
      var addStatus = function (event) {
        var s = $(event.data);
        s.find("abbr.timeago").timeago();
        $statuses.prepend(s);
      };

      var socket = new Phoenix.Socket("ws://" + location.host + "/ws");
      socket.join("live", "updates", {}, function(chan){
        chan.on("update", function(msg){
          $statuses.prepend(msg.content);
        });
      });

      $(document).ready(function() {
        $("abbr.timeago").timeago();
        //$('form').ajaxForm(function(r, status, xhr, form){
          //form[0].reset();
        //});
      }); 
      //var ws = new WebSocket("ws://localhost:4000/ws");
      //ws.onmessage = addStatus;
    })();
  </script>
</body>
</html>
